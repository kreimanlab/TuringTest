<!DOCTYPE html>
<!--
	The ad.html has a very specific format.

	Really there are two "ads" contained within this file.

	The first ad displays to participants who are browsing
	the Amazon Mechanical Turk site but have not yet accepted
	your hit.

	The second part of the ad display after the person selected
	"Accept HIT" on the Amazon website.  This will reload the
	ad and will display a button which, when clicked, will pop
	open a new browser window pointed at your local psiTurk
	server (assuming it is running and accessible to the Internet).

	See comments throughout for hints

-->
<html>
	<head>

		<script type="text/javascript">
			// Store Prolific IDs in localStorage when the page first loads
			(function() {
			  var params = new URLSearchParams(window.location.search);
			  var prolific_pid = params.get('PROLIFIC_PID');
			  var study_id = params.get('STUDY_ID');
			  var session_id = params.get('SESSION_ID');
			  
			  // Log the URL and parameters to see what's available
			  console.log("Current URL:", window.location.href);
			  console.log("Found Prolific parameters:", { 
				PROLIFIC_PID: prolific_pid, 
				STUDY_ID: study_id, 
				SESSION_ID: session_id 
			  });
			  
			  if (prolific_pid) localStorage.setItem('prolific_pid', prolific_pid);
			  if (study_id) localStorage.setItem('study_id', study_id);
			  if (session_id) localStorage.setItem('session_id', session_id);
			  
			  console.log("Stored in localStorage:", {
				prolific_pid: localStorage.getItem('prolific_pid'),
				study_id: localStorage.getItem('study_id'),
				session_id: localStorage.getItem('session_id')
			  });
			  
			  // Try alternate parameter names - Prolific sometimes uses different formats
			  if (!prolific_pid) {
				prolific_pid = params.get('prolific_pid') || params.get('PID');
				if (prolific_pid) localStorage.setItem('prolific_pid', prolific_pid);
				console.log("Found alternate prolific_pid:", prolific_pid);
			  }
			})();
		  </script>

        <meta charset="utf-8" />
		<title>Psychology Experiment</title>
		<link rel="stylesheet" href="/static/css/bootstrap.min.css" type="text/css" />
		<style type="text/css">
			/* these tyles need to be defined locally */
			body {
			    padding:0px;
			    margin: 0px;
			    background-color: white;
			    color: black;
			    font-weight: 300;
			    font-size: 13pt;
			}

			/* ad.html  - the ad that people view first */
			#adlogo {
			    width: 140px;
			    padding: 2px;
			    border: 1px solid #ccc;
			    margin-right: 1em;
			}

            #container-not-an-ad { /* obtuse name because pesky ad-blocker extensions */
				background: white;
			    margin: 30px;
			}

			h1 {
				margin-top: 0px;
			}
		</style>
	</head>
	<body>
		<div id="container-not-an-ad" class="media">
			<div class="media-left pull-left" href="#">
						<!-- REPLACE THE LOGO HERE WITH YOUR  UNIVERSITY, LAB, or COMPANY -->
						<img id="adlogo" src="{{ server_location }}/static/images/university.png" alt="Lab Logo" />
			</div>
			<div class="media-body">

							<!--
								If assignmentid is "ASSIGNMENT_ID_NOT_AVAILABLE"
								it means the participant has NOT accepted your hit.
								This should display the typical advertisement about
								your experiment: who can participate, what the
								payment is, the time, etc...

							-->
							{% if assignmentid == "ASSIGNMENT_ID_NOT_AVAILABLE" %}

							    <h1>Call for participants</h1>
							    <p>
									The Kreiman Lab at Harvard Medical School is looking for online participants for a brief conversation labeling experiment. The only requirements are that you are at least 18 years old and are a fluent English speaker. The task will require to read 20 brief conversations in total and will pay 3.0 USD.
							    </p>
							    <div class="alert alert-danger">
									<strong>This task can only be completed once.</strong>
									If you have already completed this task before, the system will not
									allow you to run again. If this looks familiar, please return the
									HIT, so someone else can participate.
							    </div>
							    <p>
								    Otherwise, please click the "Accept HIT" button on the Amazon site
								    above to begin the task.
								</p>


							{% else %}

								<!--
									OTHERWISE
									If assignmentid is NOT "ASSIGNMENT_ID_NOT_AVAILABLE"
									it means the participant has accepted your hit.
									You should thus show them instructions to begin the
									experiment ... usually a button to launch a new browser
									window pointed at your server.

									It is important you do not change the code for the
									openwindow() function below if you want you experiment
									to work.
								-->
							    <h1>Thank you for accepting this HIT!</h1>
							    <p>
							    	By clicking the following URL link, you will be taken to the experiment,
							        including complete instructions and an informed consent agreement.
							    </p>
							    <script type="text/javascript">
									function openwindow() {
										let prolificParams = window.location.search.replace(/^\?/, '&');
										//popup = window.open('{{ server_location }}/consent?hitId={{ hitid }}&assignmentId={{ assignmentid }}&workerId={{ workerid }}' + prolificParams,
                    					//					'Popup','toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=no,width='+screen.availWidth+',height='+screen.availHeight+'');
										
										popup = window.open('{{ server_location }}/consent?' + prolificParams,
                    										'Popup','toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=no,width='+screen.availWidth+',height='+screen.availHeight+'');

							    		//popup = window.open('{{ server_location }}/consent?hitId={{ hitid }}&assignmentId={{ assignmentid }}&workerId={{ workerid }}','Popup','toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=no,width='+screen.availWidth+',height='+screen.availHeight+'');
							  		}
							    </script>
							    <div class="alert alert-warning">
							    	<b>Warning</b>: Please disable pop-up blockers before continuing.
							    </div>

						    	<button type="button" class="btn btn-primary btn-lg" onClick="openwindow();">
								  Begin Experiment
								</button>


							{% endif %}
							<!--
								endif
							-->
			</div>
		</div>
	</body>
</html>
